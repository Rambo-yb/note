
| 版本     | 修改内容                                                                                                                                                                   | 日期         | 代码库版本                                        |
| ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------- | -------------------------------------------- |
| V1.0.0 | 初版                                                                                                                                                                     | 2024.08.06 |                                              |
| V1.0.1 | 添加私有协议，发现设备                                                                                                                                                            | 2024.08.15 |                                              |
| V1.0.2 | 控制请求，添加云台的上下左右控制                                                                                                                                                       | 2024.09.18 | V1.0.1<br>全景红外                               |
| V1.0.3 | 合入在线式气体探测需求内容                                                                                                                                                          | 2024.10.29 |                                              |
| V1.0.4 | 1.细分配置项与字段修改<br>2.支持多路摄像头<br>3.新增机芯调焦内容                                                                                                                                | 2024.12.03 |                                              |
| V1.0.5 | 1.添加通过multipart/form-data传输文件协议                                                                                                                                        | 2025.02.10 |                                              |
| V1.0.6 | 1.发现设备和设备信息添加设备类型，用区分不同产品<br>2.根据车载AI系统需求新增功能：<br>  1)设备端文件查询、删除、重命名控制协议接口<br>  2)查询设备端预览录像状态协议接口<br>3.在线式气体探测新增功能：<br>  1)添加cvbs预览切换通道功能<br>  2)添加内部控制请求接口，支持控制录制原始数据 | 2025.02.24 | V1.0.2<br>NGD在线式气体探测<br><br>V1.0.3<br>车载AI系统 |
| V1.0.7 | 1.添加设备录像/抓拍计划<br>2.添加osd自定义叠加内容<br>3.添加用户管理                                                                                                                            | 2025.03.14 |                                              |
| V1.0.8 | 1.添加设备编码信息、机芯畸变校正信息字段<br>2.添加telnet远程连接控制<br>3.http消息头添加基础认证                                                                                                           | 2025.05.29 |                                              |
| V1.0.9 | 1.添加onvif信息字段<br>2.添加GB28181信息字段                                                                                                                                       | 2025.06.18 | V1.0.4<br>网络机芯WEB                            |
| V1.1.0 | 1.添加弹道计算，弹道记录和激光指示灯控制接口<br>2.完善校抢配置，添加样式类型，颜色，线条粗细配置<br>3.添加伪彩，激光指示灯，画中画，和十字分划修改上报                                                                                     | 2025.07.17 |                                              |
| V1.1.1 | 1.DOT新增功能：<br>	1)添加WIFI授权请求下发，和授权处理上报<br>2.全景新增功能：<br>	1)添加获取镜头信息请求                                                                                                    | 2025.09.01 | V1.0.6<br>全景红外                               |
| V1.1.2 | 1.新增画面冻结请求<br>2.低照度图像增加透雾开关和增益调节<br>3.语言类型，增加西班牙语、德语、法语、葡萄牙语、繁中<br>4.伪彩模式，增加观鸟模式                                                                                       | 2025.09.09 |                                              |
| V1.1.3 | 1.新增bdc分划信息的获取/设置/上报<br>2.设备上报状态增加bdc分划模式                                                                                                                              | 2025.09.16 | V1.0.5<br>DOT弹弓瞄                             |

## 1 背景
1. 为简化PC端软件的设计与开发过程，使用统一的协议减少开发和维护的复杂性；
2. 不同设备之间，功能大同小异，使用统一的协议进行控制，提高网络模块的通用性。
## 2 需求分析
1. 网络模块功能，网络模块内部功能具体实现；
2. 网络模块接口，设备端对设备底层提供的函数接口；
3. 网络协议内容，设备端与PC端进行交互的具体协议内容，如：请求方式、输入/输出参数。
## 3 功能
### 3.1 网络模块功能
1. 发现设备
组播地址：239.255.255.222:6666
PC端向组播地址发送字符串"discovery cdjp device"，设备端收到消息后，回复设备地址与http协议监听端口。
```json
request boby: "discovery cdjp device"

response boby:
{
    "device_addr":"192.168.110.171",
    "http_port":8080,
    "device_type":"NGD"
}
```
2. 登录设备
3. HTTP服务器
4. 下载文件
### 3.2 网络模块接口
1. 网络模块初始化接口
2. 网络控制操作注册回调接口
3. 主动上报接口
### 3.3 网络协议
设备未实现发现设备功能，设备端监听8080端口，PC端连接设备进行通信。
设备实现发现设备功能，则根据发现设备返回的url进行通信。
所有请求消息头可携带认证信息进行用户名密码校验：
```bash
request header:
Authorization: Basic YWRtaW46MTIzNDU2
// Basic：基础认证
// YWRtaW46MTIzNDU2：<用户名>:<密码> 进行base64编码
```
未写response boby的协议，统一回复格式：
```json
response boby:
{
    "code":200, "message":"success",
    "data":""
}
code:错误码，成功返回200
message:消息，返回成功或失败原因
data:返回的数据消息
```
#### 3.3.1 PC->dev
##### 1.安全校验
```json
POST /dev_api/security
1.登录
request boby:
{
    "type":"login",
    "username":"admin",
    "password":"123456",
    "encrypt":"NONE"
}
username:用户名
password:密码
encrypt:加密方式，根据加密方式对用户名和密码进行校验，【"NONE":不加密】

2.登出
request boby:
{
    "type":"logout"
}

3.保活
request boby:
{
    "type":"keep_alive"
}
注：保活消息，每分钟发送一次，一分钟后没有接收保活消息自动断开连接，需要重新登录

4.wifi连接授权
request boby:
{
	"type":"wifi_authorization",
	"name":"oppo",
	"uuid":""
}
name:授权设备名
uuid:授权id

response boby:
{
    "code":200, "message":"success",
    "data":{
	    state:0
    }
}
state:授权状态, 【0:授权中】【1:授权成功】
注：与设备界面的授权确认异步处理，首次授权返回授权中，已经授权成功的设备返回授权成功
```
##### 2.获取能力
xxx\_support:
功能是否支持【0：不支持】【1：支持，该功能取值true/false】【>1：支持，值为该功能的取值范围最大值，最小值为0】
部分功能存在取值范围【support_state：是否支持，true/false】【min：阈值范围最小值】【max：阈值范围最大值】
xxx_support_mask:选项掩码，所有选项可在**3.4 json配置**中查找，【"0x00000000"：不支持】【其他：支持】

选项掩码说明示例：
假设所有的极性：白热、黑热、铁红、沙漠黄、绿热、红热、天空、边缘、彩虹
有一个产品机芯支持的极性为：白热、黑热、铁红、彩虹
`mask = (1 << 0) | (1 << 1) | (1 << 2) | (1 << 8)`
`pseudo_color_support_mask = "0x00000107"`

特殊情况：
electronic_zoom_support:是否支持电子变倍，【0：不支持】【1：1/2/4】【2：1-4(±0.1)】【3：1-8(±1)】【4：1/2/4/8】【5：1-4(±1)】
<font color="#ff0000">electronic_zoom_support与electronic_zoom_support_v2只支持其中一个即可，若同时支持取electronic_zoom_support电子变倍范围</font>
支持的分辨率：【640\*512】
```json
GET /dev_api/get_ability
response boby:
{
    "code":200, "message":"success",
    "data":{
        "support_function":{
	        // 配置
            "camera_ir_function":[{    // 红外机芯功能
                "support_state":0,    // 支持状态
                "image_info_function": {
                    "brightness_support":99,    // 亮度
                    "contrast_support":99,    // 对比度
                    "pseudo_color_support_mask":"0x00000000",    // 伪彩/极性掩码
                    "sharpening_support":7,    // 锐化
                    "saturation_support":99,    // 饱和度
                    "mirror_support":0,       // 镜像
                    "filp_support":1,        // 翻转
                },
                "image_enhance_function":{
                    "central_enhance_support":0,    // 中心增强
                    "detail_enhance_support":0,    // 细节增强
                },
                "calibration_function":{
                    "background_calibration_support":0,    // 背景校正
                    "shutter_calibration_support":0,    // 快门校正
                    "bad_pix_threshold_support":{    // 坏点阈值
                        "support_state":0,"min":22,"max":32
                    }
                },
                "image_zoom_function":{
                    "electronic_zoom_support":0,    // 电子变倍
                    "electronic_zoom_support_v2":{ // 电子变倍
	                    "support_state":0, "min":1, "max":8,
						"sequence_type":0, // 数列类型，【0：等差】【1：等比】
						"common_value":0.1 // 公差/公比值
                    }
                },
                "focusing_function":{
                    "focusing_mode_support_mask":"0x00000000",    // 调焦模式
                },
                "encode_info_function":[{
                    "stream_type":0,    // 指定码流类型
                    "resolution_support_mask":"0x00000000", // 分辨率类型，详见说明
                    "fps_support":{                    // 帧率范围
                        "support_state":0,"min":9,"max":50
                    },
                    "quality_support_mask":"0x00000000",        // 图像质量
                    "encode_type_support_mask":"0x00000000",        // 编码类型
                    "gop_support":{                    // I帧间隔
                        "support_state":0,"min":15,"max":60
                    },
                    "bitrate_type_support_mask":"0x00000000",    // 码率类型
                    "bitrate_max_support":{                    // 最大码率范围
                        "support_state":0,"min":2048,"max":49152
                    }
                }],
                "ldc_info_function":{
                    "view_type_support_mask":"0x00000000",    //畸变校正类型
                    "center_offset_x_support":{        // x偏移取值范围
                        "support_state":0,"min":2048,"max":49152
                    },
                    "center_offset_y_support":{        // y偏移取值范围
                        "support_state":0,"min":2048,"max":49152
                    },
                    "distortion_ratio_support"{        //畸变程度取值范围
                        "support_state":0,"min":-300,"max":300
                    },
                    "min_distortion_ratio_support"{        //最小畸变程度取值范围
                        "support_state":0,"min":-300,"max":300
                    },
                },
            }],
            "camera_vis_function":[{    // 可见光摄像头
                "support_state":0,    // 支持状态
                "image_info_function": {
                    "brightness_support":99,    // 亮度
                    "contrast_support":99,    // 对比度
                    "sharpening_support":7,    // 锐化
                    "saturation_support":99,    // 饱和度
                    "mirror_support":0,       // 镜像
                    "filp_support":1,        // 翻转
                    "gain_support":0, // 增益
                },
                "image_zoom_function":{
                    "electronic_zoom_support":0,    // 电子变倍
                    "electronic_zoom_support_v2":{ // 电子变倍
	                    "support_state":0, "min":1, "max":8,
						"sequence_type":0, // 数列类型，【0：等差】【1：等比】
						"common_value":1 // 公差/公比值
                    }
                },
                "focusing_function":{
                    "focusing_mode_support_mask":"0x00000000",    // 模式
                    "sensitivity_support_mask":"0x00000000",    // 灵敏度
                    "min_focusing_distance_support":65535,    // 最小距离
                    "focus_distance_coordinates_support":{    // 焦距坐标范围
                        "support_state":0,"min":4096,"max":49152
                    }
                },
                "image_deal_function":[{
					"fog_penetration_support":0 // 透雾功能
				}],
                "encode_info_function":[{
                    "stream_type":0,    // 指定码流类型
                    "resolution_support_mask":"0x00000000", // 分辨率类型，详见说明
                    "fps_support":{                    // 帧率范围
                        "support_state":0,"min":9,"max":50
                    },
                    "quality_support_mask":"0x00000000",        // 图像质量
                    "encode_type_support_mask":"0x00000000",        // 编码类型
                    "gop_support":{                    // I帧间隔
                        "support_state":0,"min":15,"max":60
                    },
                    "bitrate_type_support_mask":"0x00000000",    // 码率类型
                    "bitrate_max_support":{                    // 最大码率范围
                        "support_state":0,"min":2048,"max":49152
                    }
                }],
            }],
            "ptz_function":{    // 云台功能
                "ptz_info_support":0,    // 全景云台信息
                "preset_support":0    // 预置点
            },
            "algorithm_function":{    // 算法功能
                "algorithm_info_function":{
                    "area_support":0    // 报警区域
                },
                "detection_algorithm_function":{
                    "object_detection_support":0,    // 目标检测
                    "tracking_support":0,    // 追踪
                    "action_analyze_support":0,    // 行为分析
                    "fire_point_support":0,    // 火点检测
                    "gas_detection_support":0    // 气体检测
                },
                "image_algorithm_function":{
                    "gas_display_support":0, // 气体显示增强
                    "outdoor_mode_support":0,    // 户外模式
                    "splicing_support":0,    // 图像拼接
                    "fusion_mode_support_mask":"0x00000000"    // 融合模式
                }
            },
            "network_function":{    // 网络功能
                "onvif_protocol_support":0,    // onvif协议
                "ipv6_protocol_support":0,    // ipv6
                "gb28181_protocol_support":0,    // gb28181协议
            },
            "display_screen_function":{    // 显示屏功能
                "display_info_function":{
                    "picture_in_picture_support_mask":"0x00000000", // 画中画
                    "electronic_compass_support":0,    // 电子罗盘
                    "language_support_mask":"0x00000000", // 语言掩码
                    "red_dot_support":0 // 红点
                },
                "calibration_gun_function":{    // 校枪功能
                    "support_state":0,    // 支持状态
                    "graticule_style_support_mask":"0x00000000",    // 分划掩码
                    "distence_support":1200,    // 最远距离
                    "color_support_mask":"0x00000000",    // 分划颜色掩码
                    "line_support":0,    // 线条粗细等级
                    "coordinate_x_support":{        // 分划x坐标取值范围
                        "support_state":0,"min":-262,"max":262
                    },
                    "coordinate_y_support":{        // 分划y坐标取值范围
                        "support_state":0,"min":-196,"max":196
                    }
                },
                "bdc_graticule_function":{
	                "support_state":0, // 支持状态
	                "peephole_line_support":0, // 窥孔辅助线
	                "graticule_style_support_mask":"0x00000000", // 分划掩码
	                "unit_support_mask":"0x00000000", // 单位掩码
	                "graticule_support":[{
		                "display_support_mask":"0x00000000", // 显示状态掩码 
	                	"distance_support":1200,    // 最远距离
	                    "color_support_mask":"0x00000000",    // 分划颜色掩码
	                    "line_support":0,    // 线条粗细等级
	                    "coordinate_x_support":{        // 分划x坐标取值范围
	                        "support_state":0,"min":-262,"max":262
	                    },
	                    "coordinate_y_support":{        // 分划y坐标取值范围
	                        "support_state":0,"min":-196,"max":196
	                    }
	                }]
                }
            },
            "other_function":{    // 其他功能
                "other_info_function":{
                    "heat_support":0,    // 加热
                    "fan_support":0,    // 风扇
                    "wipers_support":0,    // 雨刷
                    "fill_light_support":0    // 补光灯
                },
                "preview_function":{
                    "hdmi_support":0,    // hdmi传输
                    "cvbs_support":0    // cvbs传输
                }
            },
            // 控制
            "control_request_function":{
	            "bad_pix_support":0, // 坏点校正
				"shutter_calibration_support":0, // 快门校正
	            "laser_ranging_support":0, // 激光测距
	            "tracking_object_support":0, // 目标追踪
	            "electric_focus_support":0, // 电动调焦
	            "laser_light_support":0, // 激光指示灯
	            "ballistic_calculation_support":0, // 弹道计算
	            "ballistic_record_support":0, // 弹道记录表
	            "freeze_video_support":0 // 画面冻结
            }
        }
    }
}
```
##### 3.系统请求
```json
1.重启
GET /dev_api/system_request?type=device_reboot

2.恢复出厂设置
GET /dev_api/system_request?type=device_reset

3.格式化
GET /dev_api/system_request?type=device_format

4.设备信息
GET /dev_api/system_request?type=device_info
response boby:
{
    "code":200, "message":"success",
    "data":{
        "device_info":{
            "soft_version":"01.01",
            "hard_version":"00.01",
            "serial_number":"1234567890",
            "device_type":"NGD"
        }
    }
}
soft_version:软件版本号
hard_version:硬件版本号
serial_number:设备序列号
device_type:设备类型

5.时间设置
GET /dev_api/system_request?type=set_time&time=1729563212
time：UTC时间戳，设备端自行进行时区偏移

6.获取rtsp流地址
GET /dev_api/system_request?type=get_rtsp_url&camera=0
response boby:
{
    "code":200, "message":"success",
    "data":{
        "rtsp_url":{
            "main_stream":"rtsp://192.168.110.168:554/live/main_stream",
            "sub_stream":"",
            "third_stream":""
        }
    }
}
rtsp_url:rtsp地址

7.系统信息
GET /dev_api/system_request?type=system_info
{
    "code":200, "message":"success",
    "data":{
        "system_info":{
            "cpu_useage":20.0,
            "mem_useage":10.0
        }
    }
}
cpu_useage:cpu使用率
mem_useage:内存使用率

8.获取时间
GET /dev_api/system_request?type=get_time
response boby:
{
    "code":200, "message":"success",
    "data":{
        "time":1729563212
    }
}
time:设备UTC时间

9.镜头信息
GET /dev_api/system_request?type=camera_info&camera=0
response boby:
{
	"code":200, "message":"success",
	"data":{
		"camera_info":{
			"focal_distance":55,
			"field_angle":12.75,
			"images":1
		}
	}
}
focal_distance:焦距, 单位:mm
field_angle:视场角, 单位:°
images:图像数量, 全图由多少张图拼接而成
```
##### 4.获取配置
```json
POST /dev_api/get_config

1.获取所有配置
request boby:
{
    "conf_name":"system.time_info"
}
conf_name:配置名，填不同配置获取不同的配置

response boby:
{
    "code":200, "message":"success"
    "data":{
        "conf_name":"system.time_info",
        "config_info":{...}
    }
}

2.获取数组配置中的某一项
request boby:
{
    "conf_name":"camera_ir.image_info.[0]"
}
conf_name:配置名，填不同配置获取不同的配置

response boby:
{
    "code":200, "message":"success"
    "data":{
        "conf_name":"camera_ir.image_info.[0]",
        "config_info":[{...}]
    }
}
```
##### 5.设置配置
```json
POST /dev_api/set_config

1.设置任意配置
request boby:
{
    "conf_name":"system.time_info",
    "config_info":{...}
}
conf_name:配置名，填不同配置获取不同的配置

2.设置数组配置中的某一项
request boby:
{
    "conf_name":"camera_ir.image_info.[0]",
    "config_info":[{...}]
}
conf_name:配置名，填不同配置获取不同的配置
```
##### 6.控制请求
所有设备都有的控制：
```json
1.抓拍
GET /dev_api/control_request?type=snap&camera=0

2.录像
GET /dev_api/control_request?type=record&camera=0&state=0
state:录像状态，【0:停止录像】【1:开始录像】

3.云台控制
GET /dev_api/control_request?type=ptz_ctrl&mode=0
mode:云台方向控制，【0:上】【1:下】【2:左】【3:右】【4:归零】

4.设备文件操作
POST /dev_api/control_request?type=file_operation
request boby:
{
    "type":"record",
    "mode":"query",
    "query":{
        "page":1,
        "sort":0
        "start_time":1729563212,
        "end_time":1729563212
    },
    "modify":{
        "old_filename":"123.mp4",
        "new_filename":"456.mp4"
    },
    "delete":{
        "file_name":"123.mp4"
    }
}
type:文件类型，【"record":普通录像】【"image":图片】
mode:控制方式，【"query":查询文件信息】【"modify":文件重命名】【"delete":删除指定文件】
query:查询文件信息，模式为查询使用
page:查询某一页的录像，【n >= 1：查询第n页的录像文件】
sort:排序，【0：顺序】【1：倒序】
start_time:查询录像开始时间，【0：全部时段文件】
end_time:查询录像结束时间，【0：全部时段文件】
modify:修改文件名，模式为修改使用
old_filename:修改前文件名
new_filename:修改后文件名
delete:删除文件，模式为删除使用
file_name:要删除的文件
注：模式对应json必须传，其他的可不传

查询文件回复格式：
response boby:
{
    "code":200, "message":"success",
    "data":{
        "file_info":{
            "file_num":100,
            "page_num":5,
            "cur_page":1,
            "info":[{
                "name":"xxx.mp4",
                "size":10222,
                "start_time":1729563212,
                "end_time":1729563272,
            },{
                "name":"xxx.mp4",
                "size":10222,
                "start_time":1729563272,
                "end_time":1729563332
            },...]
        }
    }
}
file_num：文件总个数
page_num：文件总页数
cur_page：当前文件信息属于第几页
file_info：
name：文件名
size：文件大小
start_time：开始时间
end_time：结束时间

5.查询设备状态
GET /dev_api/control_request?type=device_status
response boby:
{
    "code":200, "message":"success"
    "data":{
        "device_status":{
            "preview_record":0
        }
    }
}
preview_record:预览录像状态，【0：未预览】【1：预览中】

6.开启telnet功能
GET /dev_api/control_request?type=telnet&enable=0
enable:telnet功能开关，【0：关闭】【1：开启】
```
部分设备才有的控制：
```json
1.机芯坏点校正
GET /dev_api/control_request?type=bad_pix&camera=0&oper=0
oper:控制操作，【0：获取坏点数】【1：清除】【2：恢复】【3：保存】

获取坏点数：
response boby:
{
    "code":200, "message":"success",
    "data":{
        "bad_pix_num":123
    }
}
bad_pix_num:坏点数

2.机芯手动快门校正
GET /dev_api/control_request?type=shutter_calibration&camera=0

3.激光测距
GET /dev_api/control_request?type=laser_ranging&mode=0&state=0
mode:测距方式，【0:单次测距】【1:连续测距】
state:连续测距状态，单次测距可忽略，【0：结束测距】【1：开始测距】

单次测距：
response boby:
{
    "code":200, "message":"success",
    "data":{
        "distance":123
    }
}
distance:距离, 单位:cm

4.目标追踪
POST /dev_api/control_request?type=tracking_object
request boby:
{
    "tracking_object":[0,1]
}
tracking_object:追踪目标id

5.红外电动调焦
GET /dev_api/control_request?type=infrared_electric_focus&camera=0&mode=0
mode:电动调焦方向，【0：停止】【1：左转】【2：右转】

6.cvbs预览通道切换
GET /dev_api/control_request?type=cvbs_switch_preview&camera=0

7.激光指示灯
GET /dev_api/control_request?type=laser_light&enable=0
enable:使能开关，【0：关】【1：开】

8.弹道计算
POST /dev_api/control_request?type=ballistic_calculation
request boby:
{
    "gun":{
        "name":"test",
        "twist":16.00,
        "rotation":0,
        "fixed_deviation":0,
        "zero_distence":0.0,
        "baseline_height":0.0,
        "click_unit":0,
        "up_and_down_click":0.0,
        "windage_click":0.0
    },
    "bullet":{
        "name":"test",
        "length":0.0,
        "caliber":0.0,
        "weight":0.0,
        "drag_model":0,
        "initial_velocity":0.0,
        "bc":0.0
    },
    "distence":0.0,
    "pitch_angle":0.0,
    "environment":{
        "wind_direction":0.0,
        "wind_speed":0.0,
        "temperature":0.0,
        "humidity":0.0,
        "air_pressure":0.0
    },
    "coriolis_effect":{
        "enable":0,
        "lat":0.0,
        "azimuth":0.0
    }
}
gun:武器
name：武器名字
twist：缠距，单位:inch
rotation：【0：左旋】【1：右旋】
fixed_deviation:定偏，【true/false】
zero_distence:归零距离，单位:m
baseline_height:基线高度，单位:cm
click_unit:咔哒值单位，【0：CM】【1：MOA】【2：MRAD】【3：MIL】【4：INCH】
up_and_down_click:上下咔哒值
windage_click:风偏咔哒值
bullet:子弹
name:子弹名称
length:长度，单位:mm
caliber:口径，单位:mm
weight:弹头重量，单位:g
drag_model:阻力模型，【0：G1】【1：G7】【2：RA4】【3：GA】【4：GL】【5：GS】【6：G8】
initial_velocity:初速，单位:m/s
bc:弹道系数，BC值
distence:距离，单位:m
pitch_angle:俯仰角，单位:°
environment:环境
wind_direction:风向，单位:°
wind_speed:风速，单位:m/s
temperature:温度，单位:°C
humidity:湿度，单位:%
air_pressure:气压，单位:mmHg
coriolis_effect:科里奥利效应
enable:使能开关，【true/false】
lat:纬度，单位:°
azimuth:方位角，单位:°

response boby:
{
    "code":200, "message":"success",
    "data":{
        "bullet_landing_point":{
            "longitudinal_offset":0.0,
            "lateral_offset":0.0
        }
    }
}
bullet_landing_point:弹着点
longitudinal_offset:纵向偏移，单位:inch
lateral_offset:横向偏移，单位:inch

9.弹道记录
POST /dev_api/control_request?type=ballistic_record
request boby:
{
    "name":"test",
    "distence":0.0,
    "pitch_angle":0.0,
    "record":[{
        "distence":0.0,
        "offset":0.0
    },{
        "distence":1000.0,
        "offset":1.0
    }]
}
name:弹道表名称
distence:距离，单位:m
pitch_angle:俯仰角，单位:°
record:弹道记录
[]:记录表数组
distence:距离，单位:m
offset:下坠偏移，单位:inch

10.画面冻结
GET /dev_api/control_request?type=freeze_video&camera=0&enable=0
enable:画面冻结使能
```
##### 7.下载请求
PC端向设备的传递文件。异步下载，返回成功仅表示设备成功收到请求。
```json
POST /dev_api/download
request boby: 
1.application/json
{
    "type":"upgrade",
    "url":"http://192.168.110.2:8080/xxx",
    "size":"1111",
    "md5":""
}
type:类型，【"upgrade"：升级包】【"upgrade camera"：机芯升级包】
url:下载地址，【"not download:<file_path>":不需要下载升级文件，传递文件路径】
size:下载文件的大小
md5:下载文件的md5值

2.multipart/form-data
key:type, value:【"upgrade"：升级包】【"upgrade camera"：机芯升级包】
key:size, value:文件大小
key:md5,  value:md5值
key:file, value:文件
```
##### 8.PC信息
dev->pc，使用http协议上传，需要pc创建服务器。但因为pc不同，ip不同，设备不知道pc http服务器的地址，故需要pc下发相关信息。
```json
POST /dev_api/pc_info
request boby:
{
    "http_svr_url":"http://192.168.110.2:8080"
}
http_url:pc端http服务器地址
```
##### 9.数据透传接口
数据透传接口，上位机下发内容直接转发到下层。
```json
POST /dev_api/transparent_transmission
request boby:
{
    "type":"PTZ",
    "data":"",
    "is_response":0
}
type:透传内容模块，【PTZ:云台】【IR_camera.[chn]:红外机芯,chn表示通道号】
data:透传数据，规定：十六进制转字符串以%02x方式
is_response:是否等待响应，【true/false】
```
##### 10.内部控制
```json
1.录制原始数据
GET /dev_api/internal_request?type=record_raw&camera=0&state=0
camera:摄像头
state:录制状态【0：停止录制】【1：开始录制】
```
#### 3.3.2 dev->PC
##### 1.报警信息
```json
POST /pc_api/alarm_info
request boby:
{
    "type":"over_boundary",
    "state":0,
    "time":1721212121,
    "info":{
        ...
    }
}
type:报警类型，【越界："over_boundary"】【区域入侵："area_intrude"】【异常行为："abnormal_action"】【火点检测："fire_point_detection"】【温度异常："temperature_abnormal"】【 电压异常："voltage_abnormal"】【电流异常："ampere_abnormal"】【气体泄漏："gas_leakage"】
state:状态，【0：结束】【1：开始】【2：触发】
time:时间戳
info:不同报警类型，需要携带的独立信息
```
##### 2.外设信息
```json
POST /pc_api/peripheral_info
request boby:
{
    "yaw":0,
    "pitch":0,
    "motor_temperature":25,
    "input_voltage":25,
    "working_ampere":22,
    "longitude":0,
    "latitude":0
}
yaw:航偏角
pitch:俯仰角
motor_temperature:电机温度
input_voltage:输入电压
working_ampere:工作电流
longitude:经度（预留）
latitude:纬度（预留）
```
##### 3.其他信息
```json
POST /pc_api/other_info

1.下载
request boby:
{
    "type":"download",
    "data":{
        "state":"downloading"
    }
}
state:下载状态，【下载中："downloading"】【下载成功："download success"】【下载失败："download fail"】

2.升级
request boby:
{
    "type":"upgrade",
    "data":{
        "state":"upgrading"
    }
}
state:升级状态，【升级中："upgrading"】【升级成功："upgrade success"】【升级失败："upgrade fail"】

3.持续激光测距
{
    "type":"laser_ranging",
    "data":{
        "distance":123
    }
}
distance:距离, 单位:cm

4.图像信息
{
    "type":"image_info",
    "data": {
        "chn":0,
        "pseudo_color":0,
        "electronic_zoom":0.0
    }
}
chn:图像通道
pseudo_color:伪彩
electronic_zoom:电子变倍

5.设备状态
{
    "type":"device_status",
    "data":{
        "laser_light":0,
        "picture_in_picture":0,
        "bdc_mode":0
    }
}
laser_light:激光指示灯状态
picture_in_picture:画中画状态
bdc_mode:bdc模式

6.校枪信息
{
    "type":"calibration_gun",
    "data":{
        "gun_type":"",
        "graticule_style":0,
        "distence":0,
        "color":0,
        "line":0,
        "coordinate":{
            "x":0, 
            "y":0
        } 
    }
}
注：具体字段见配置"display_screen.calibration_gun"

7.wifi授权信息
{
	"type":"wifi_authorization",
	"data":{
		"state":0,
		"name":"",
		"uuid":""
	}
}
state:授权状态, 【0:授权中】【1:授权成功】【2:取消授权】【3:删除授权】
name:授权设备名
uuid:授权id

8.BDC分划信息
{
	"type":"bdc_graticule",
	"data":{
		"peephole_line":0,
		"graticule_style":0,
		"unit":0,
		"graticule":[{
			"tag":"A",
			"display":0,
		    "distance":0,
		    "color":0,
		    "line":0,
		    "coordinate":{
		        "x":0, 
		        "y":0
		    }
		},{
			"tag":"B",
			"display":0,
		    "distance":0,
		    "color":0,
		    "line":0,
		    "coordinate":{
		        "x":0, 
		        "y":0
		    }
		}]
	}
}
注：具体字段见配置"display_screen.bdc_graticule"
```
### 3.4 json配置
##### 1.系统配置
```json
1.时间信息
"system.time_info": {
    "time_zone":"UTC+08:00",
    "time_format":1,
    "summer_time":0,
    "timing_type":0
}
time_zone:时区，按示例样式传递字符串【"UTC+08:00"/"UTC-06:00"/"UTC+00:00"】
time_format:时间格式，【0：12h】【1：24h】
summer_time_enable:夏令时，【true/false】
timing_type:校时类型，【0：手动校时】【1：ntp校时】

2.用户管理
"system.user_manager": {
    "oper_type":0,
    "users_info":[{
        "username":"admin",
        "password":"123456",
        "user_type":0
    }]
}
oper_type:设置操作类型，【0：添加】【1：删除】【2：修改】
username:用户名
password:密码
user_type:用户类型，【0：普通用户】【1：管理员】
```
##### 2.红外机芯配置
```json
1.图像信息
"camera_ir.image_info": [{
    "brightness":50,
    "contrast":50,
    "sharpening":50,
    "saturation":50,
    "pseudo_color":0,
    "mirror":0,
    "filp":0
}]
[]:多通道
brigthness:亮度，不同设备，取值范围不同，根据设备能力确定取值范围
contrast:对比度，不同设备，取值范围不同，根据设备能力确定取值范围
sharpening:锐化，不同设备，取值范围不同，根据设备能力确定取值范围
saturation:饱和度，不同设备，取值范围不同，根据设备能力确定取值范围
pseudo_color:伪彩/极性，【0：白热】【1：黑热】【2：铁红】【3：沙漠黄】【4：绿热】【5：红热】【6：天空】【7：边缘】【8：彩虹】【9：反铁红】【10：熔盐】【11：反熔盐】【12：反彩虹】【13：彩虹高对比度】【14：反彩虹高对比度】【15：观鸟模式】
mirror:镜像，【true/false】
filp:翻转，【true/false】

2.图像增强
"camera_ir.image_enhance": [{
    "central":0,
    "detail":0
}]
central:中心增强，【0-2】
detail:细节增强，【true/false】

3.图像变倍
"camera_ir.image_zoom": [{
    "electronic_zoom":0
}]
electronic_zoom:电子变倍，不同设备，取值不同，根据设备能力确定取值范围 【1/2/4/8】【1-4(±0.1)】【1-8(±1)】

4.调焦
"camera_ir.focusing": [{
    "focusing_mode":0
}]
focusing_mode:调焦模式，【0：自动聚焦】【1：电动聚焦】

5.校正
"camera_ir.calibration": [{
    "shutter":0,
    "background":0,
    "bad_pix_threshold":0
}]
shutter:快门校正，【true/false】
background:背景校正，【true/false】
bad_pix_threshold:坏点阈值，【20-32】

6.OSD设置
"camera_ir.osd_info":[{
    "show_camera_name":0,
    "camera_name":"",
    "camera_name_pos": {"x":0, "y":100},

    "show_date":0,
    "show_week":0,
    "date_pos": {"x":0, "y":100},

    "string_overlay":[{
        "show":0,
        "value":"",
        "pos": {"x":0, "y":100}
    },{
        "show":0,
        "value":"",
        "pos": {"x":0, "y":100}
    }],
    
    "osd_attribute":{
        "color":"#FFFFFF",
        "size":0,
        "flicker":0,
        "transparency":0
    }
}]
show_camera_name:显示通道名，【true/false】
camera_name:通道名称
camera_name_pos:通道名称叠加位置，左上点
show_date:显示日期，【true/false】
show_week:显示星期，【true/false】
date_pos:日期叠加位置
string_overlay:字符串叠加，最大数组4个
show:显示，【true/false】
value:字符串
pos:叠加位置
osd_attribute:osd属性
color:颜色，rgb888字符串
size:字体大小
flicker:闪烁，【true/false】
transparency:透明，【true/false】

7.图像编码信息
"camera_ir.encode_info":[[{
    "stream_type":0,
    "resolution":{
        "width":640,
        "height":512
    },
    "fps":25,
    "quality":0,
    "encode_type":0,
    "gop":0,
    "bitrate_type":0,
    "bitrate_max":0
}]]
stream_type：码流类型，【0：主码流】【1：子码流】【2：第三码流】
resolution：分辨率
fps：帧率
quality：图像质量，【0：低】【1：中】【2：高】
encode_type：编码类型，【0：h264】【1：h265】
gop：I帧间隔
bitrate_type：码率类型，【0：定码率】【1：变码率】
bitrate_max：最大码率

8.畸变校正
"camera_ir.ldc_info":[{
    "enable":0,
    "view_type":0,
    "center_offset":{
        "x":0, 
        "y":0
    },
    "distortion_ratio":0,
    "min_distortion_ratio":0
}]
enable：使能，【true/false】
view_type：校正类型，【0：全模式】【1：裁剪模式】
center_offset：相对图像中心偏移
distortion_ratio：畸变程度
min_distortion_ratio：最小畸变程度
```
##### 3.可见光摄像头配置
```json
1.图像信息
"camera_vis.image_info": [{
    "brightness":50,
    "contrast":50,
    "sharpening":50,
    "saturation":50,
    "mirror":0,
    "filp":1,
    "gain":0
}]
[]:多通道
brigthness:亮度，不同设备，取值范围不同，根据设备能力确定取值范围
contrast:对比度，不同设备，取值范围不同，根据设备能力确定取值范围
sharpening:锐化，不同设备，取值范围不同，根据设备能力确定取值范围
saturation:饱和度，不同设备，取值范围不同，根据设备能力确定取值范围
mirror:镜像，【true/false】
filp:翻转，【true/false】
gain:图像增益

2.图像变倍
"camera_vis.image_zoom": [{
    "electronic_zoom":0
}]
electronic_zoom:电子变倍，不同设备，取值不同，根据设备能力确定取值范围 【1/2/4/8】【1-4(±0.1)】【1-8(±1)】

3.调焦
"camera_vis.focusing": [{
    "focusing_mode":0,
    "sensitivity":0,
    "min_focusing_distance":300,
    "focus_distance_coordinates":4096
}]
focusing_mode:调焦模式，【0：自动聚焦】【1：一次聚焦】【2：手动聚焦】【3：半自动聚焦】
sensitivity:灵敏度，【0：普通】【1：低】
min_focusing_distance：最近可聚焦距离
focus_distance_coordinates:焦距坐标

4.图像处理
"camera_vis.image_deal":[{
    "fog_penetration":0
}]
fog_penetration:图像透雾功能，【true/false】

5.图像编码信息
"camera_vis.encode_info":[[{
    "stream_type":0,
    "resolution":{
        "width":640,
        "height":512
    },
    "fps":25,
    "quality":0,
    "encode_type":0,
    "gop":0,
    "bitrate_type":0,
    "bitrate_max":0
}]]
stream_type：码流类型，【0：主码流】【1：子码流】【2：第三码流】
resolution：分辨率
fps：帧率
quality：图像质量，【0：低】【1：中】【2：高】
encode_type：编码类型，【0：h264】【1：h265】
gop：I帧间隔
bitrate_type：码率类型，【0：定码率】【1：变码率】
bitrate_max：最大码率
```
##### 4.云台配置
```json
1.云台信息
"ptz.ptz_info": { 
    "motor_enable":0,     
    "scan_mode":0,
    "constant_scan": {
        "deflection_mode":0,
        "yaw":0.0,
        "pix":{"x":0, "y":100}
    },
    "fan_scanning":{
        "start_angle":0.0,
        "end_angle":0.0
    },
    "pitch":0.0,
    "speed":65535,
    "step":9.0
}
motor_enable:电机使能，【true/false】
scan_mode:扫描模式，【0：周扫描】【1：扇扫描】【2：定扫描】
constant_scan:定扫描字段
    deflection_mode:偏转模式，【0：角度】【1：像素点】
    yaw:航偏角，定扫描按角度偏转使用
    pix:像素点，定扫描按像素点偏转使用
fan_scanning:扇扫描字段
    start_angle:起始角
    end_angle:终止角
pitch:俯仰角，【-25-30】
speed:速度，【0-65535】
step:步长，可被360整除

2.预置点
"ptz.presets":[{
    "name":"preset_0",
    "num":0
}]
name:预置点名，用户分辨不同预置点
num:预置点编号，【0-255】

```
##### 5.算法配置
```json
1.检测算法
"algorithm.detection_algorithm":{
    "object_detection":0,
    "tracking":0,
    "action_analyze":0,
    "gas_detection":0
}
detection:目标检测，【true/false】
tracking:跟踪，【true/false】
action_analyze:行为分析，【true/false】
gas_detection:气体检测，【true/false】

2.区域
"algorithm.areas":[{
    "area_name":"",
    "enable":1,
    "point_num_max":8,
    "point_num":4,
    "point":[{"x":0, "y":0},{...}]
}]
area_name:区域名称
enable:区域使能，【true/false】
point_num_max:区域点最大坐标点数
point_num:区域的使用坐标点数，【2-point_num_max】
point:坐标点

3.图像算法
"algorithm.image_algorithm":{
    "gas_display_enhance":0,
    "outdoor_mode":0,
    "fusion_mode":0
}
gas_display_enhance:图像增强显示，【true/false】
outdoor_mode:户外模式，【true/false】
fusion_mode:融合模式，【0：可见光】【1：红外】【2：融合】
```
##### 6.网络配置
```json
1.网络信息
"network.tcp/ip":{
    "dhcp_enable":0,
    "ipv4_enable":1,
    "ipv4_addr":"192.168.110.223",
    "ipv4_mask":"255.255.255.0",
    "ipv4_gateway":"192.168.110.1",
    "ipv6_enable":0,
    "ipv6_addr":"",
    "mac":"AE:A1:EB:19:79:3C",
    "ipv6_gateway":"",
    "dns":"8.8.8.8",
    "alt_dns":"114.114.114.114"
}
dhcp_enable:dhcp使能，【true/false】
ipv4_enable:ipv4使能，【true/false】
ipv4_addr:ipv4地址
ipv4_mask:ipv4掩码
ipv4_gateway:ipv4网关
ipv6_enable:ipv6使能，【true/false】
ipv6_gateway:ipv6网关
mac:mac地址
dns:dns
alt_dns:备选dns

2.ntp信息
"network.ntp_info": {
    "server_addr":"",
    "port":224,
    "interval":1440
}
server_addr:服务器地址
port:NTP端口
interval:校时时间间隔，单位：分钟

3.onvif信息
"network.onvif": {
    "enable":0
}
enable:onvif使能，【true/false】

4.gb28181信息
"network.gb28181": {
    "enable":0,
    "sip_server_id":"41010500002000000001",
    "sip_server_domain":"4101050000",
    "sip_server_addr":"192.168.110.124",
    "sip_server_port":15060,
    "sip_username":"41010500002000000002",
    "sip_password":"12345678",
    "register_valid":3600,
    "register_interval":60,
    "keepalive_interval":60,
    "max_timeout_num":3,
    "chn_id":["41010500000000000000","41010500000000000001"]
}
enable:gb28181使能，【true/false】
sip_server_id:sip服务器id
sip_server_domain:sip服务器域名
sip_server_addr:sip服务器地址
sip_server_port:sip服务器端口
sip_username:sip用户名
sip_password:sip密码
register_valid:注册有效期
register_interval:注册间隔
keepalive_interval:心跳间隔
max_timeout_num:最大心跳超时次数
chn_id:通道视频id
```
##### 7.显示屏配置
```json
1.显示信息
"display_screen.display_info":{
    "picture_in_picture":0,
    "electronic_compass":0,
    "language":0
}
picture_in_picture:画中画，【0：关闭】【1：左上】【2：中上】【3：右上】
electronic_compass:电子罗盘，【true/false】
language:语言，【0：中】【1：英】【2：俄】【3：西班牙】【4：德】【5：法】【6：葡萄牙】【7：繁中】【8：挪威】【9：瑞典】

2.校枪
"display_screen.calibration_gun":{
    "gun_type":"",
    "graticule_style":0,
    "distence":0,
    "color":0,
    "line":0,
    "coordinate":{
        "x":0, 
        "y":0
    }
}
gun_type:枪型(预留)
graticule_style:分划样式，【0：隐藏】【1~7：样式一~样式七】，样式见附录一
distence:距离
color:颜色，【0：白】【1：红】【2：绿】【3：黄】
line:线条粗细
coordinate:坐标

3.红点
"display_screen.red_dot":{
    "enable":0,
    "coordinate":{
        "x":0,
        "y":0
    }
}

4.BDC分划线
"display_screen.bdc_graticule":{
	"peephole_line":0,
	"graticule_style":0,
	"unit":0,
	"graticule":[{
		"tag":"A",
		"display":0,
	    "distance":0,
	    "color":0,
	    "line":0,
	    "coordinate":{
	        "x":0, 
	        "y":0
	    }
	},{
		"tag":"B",
		"display":0,
	    "distance":0,
	    "color":0,
	    "line":0,
	    "coordinate":{
	        "x":0, 
	        "y":0
	    }
	}]
}
peephole_line:窥孔辅助线，【true/false】
graticule_style:分划样式，【8：样式八·】【9：样式九+】
unit:单位，【0：米】【1：码】
graticule:分划线
tag:标签名
display:显示状态，【0：隐藏】【1：显示】【2：显示(距离)】
distance:距离
color:颜色，【0：白】【1：红】【2：绿】【3：黄】
line:线条粗细
coordinate:坐标
```
##### 8.其他配置
```json
1.其他信息
"other.other_info":{
    "heat":0,
    "fan":0,
    "wipers":0,
    "fill_light":0
}
heat:加热使能，【0：关闭】【1：打开】【2：自动】
fan:风扇使能，【true/false】
wipers:雨刷使能，【true/false】
fill_light:补光灯控制，【0：关闭】【1：打开】【2：自动】

2.显示
"other.preview":{
    "hdmi":0,
    "cvbs":0
}
hdmi:hdmi使能，【true/false】
cvbs:cvbs使能，【true/false】

3.定位信息
"other.position_info":{
    "position_mode":0,
    "external_position":0,
    "target_guidance":0,
    "first_and_last_target":0,
    "multi_point_position":0,
}
position_mode:定位模式，【0：GPS】【1：BD】【2：GPS&BD】
external_position:外部定位，【true/false】
target_guidance:目标引导，【true/false】
first_and_last_target:首末目标，【true/false】
multi-point_position:多点定位，【true/false】
```
##### 9.存储配置
```json
1.存储信息
"storage.storage_info":{
    "snap_proportion":5,
    "record_proportion":90
}
snap_proportion:抓图空间占比
record_proportion:录像空间占比

2.录像计划
"storage.record_program": {
    "enable":0,
    "cycle_write":0,
    "prerecord_time":0,
    "record_delay":0,
    "stream_type":0,
    "program":[[{
        "type":0,
        "start_time":"00:00",
        "end_time":"24:00"
    }],[{
        "type":0,
        "start_time":"00:00",
        "end_time":"06:00"
    },{
        "type":0,
        "start_time":"07:00",
        "end_time":"12:00"
    }]...]
}
enable:录像计划使能，【true/false】
cycle_write:循环写，【true/false】
prerecord_time:预录时间
record_delay:录像延迟
stream_type:码流类型，【0：主码流】
program:录制计划，第一层数组表示星期几，第二层数组表示一天的其中一个时间段，最高8个时间段，时间段不可重复
type:录像类型，【0：定时】
start_time:开始时间
end_time:结束时间

3.抓拍计划
"storage.snap_program": {
    "stream_type":0,
    "program":[[{
        "type":0,
        "start_time":"00:00",
        "end_time":"24:00"
    }],[{
        "type":0,
        "start_time":"00:00",
        "end_time":"06:00"
    },{
        "type":0,
        "start_time":"07:00",
        "end_time":"12:00"
    }]...]
}
stream_type:码流类型，【0：主码流】
program:录制计划，第一层数组表示星期几，第二层数组表示一天的其中一个时间段，最高8个时间段，时间段不可重复
type:录像类型，【0：定时】
start_time:开始时间
end_time:结束时间

4.抓拍参数
"storage.snap_param":{
    "timing_snap_enable":0,
    "timing_snap":{
        "image_format":0,
        "resolution":0,
        "quality":0,
        "interval":0,
        "num":1
    }
}
timing_snap_enable:定时抓图使能，【true/false】
image_mode:图片格式，【0：JPEG】
resolution:分辨率(预留)
quality:质量，【0：低】【0：中】【0：高】
interval:时间间隔，单位：秒
num:抓拍数
```
## 附录一：分划样式
##### 分划样式一
![image](images/14kBFFDqNnFqu8w-h7E3X5tfo8JYIzWlTDTbfgxD9HA.png)

##### 分划样式二
![image](images/9CxQ_FWaF1EAXXIJ3uncEDXTm5UY971ReCAsOI2d1FI.png)

##### 分划样式三
![image](images/Zu4pBL393ejVIfqgFxiWHEOZwaTxQaQqK_m1KBrvRmI.png)

##### 分划样式四
![image](images/n36BaT8cdlM-1nokfyRBnsHGhk9kcpS9NYRvC1mnRDc.png)

##### 分划样式五
![image](images/ZT0jXvy-ShcjWBWMeV0-vROr7mRIngU6UwD2dYwVWaM.png)

##### 分划样式六
![image](images/AQjkklnVNOgG3oIlZLMhuxF6pqfSRL1Inej4G9FFRAM.png)

##### 分划样式七
![image](images/n8krighfBrOTuevt6MTqUft2urrl7kRTBnAqRUkvE3U.png)

