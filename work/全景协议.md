| 版本     | 修改内容                            | 日期       |
| ------ | ------------------------------- | -------- |
| V1.0.0 | 协议初版                            | 24.05.13 |
| V1.0.1 | 合并设备控制与算法开关到设置/获取配置中            | 24.05.22 |
| V1.0.2 | 根据底层实际需求修改PTZ传参字段，其他设置添加加热、风扇使能 | 24.06.06 |

## pc->dev
设备端http服务器端口：8080

### 设置配置
```json
POST /dev_api/set_config
1.监控区域
request boby:
{
    "conf_name":"areas",
    "areas":[{
        "area_name":"", // 区域名称
        "enable":1, // 区域使能
        "point_num_max":8, // 最大坐标数量
        "point_num":4, // 使用坐标点数量
        "point":[{
            "x":0,
            "y":0
        },{...}]
    }]
}

2.算法开关
{
    "conf_name":"algorithm_enable",
    "algorithm_enable": {
        "detection_enable":0, // 目标检测
        "tracking_enable":0, // 跟踪
        "action_analyze_enable":0, // 行为分析
        "tracking_object":[0, 3] // 跟踪目标数及目标id
    }
}

3.云台控制
request boby:
{
    "conf_name":"ptz_ctrl",
    "ptz_ctrl": { 
        "motor_enable":0， // 电机使能     
        "scan_mode":0, // 扫描模式，1:周扫描、2:扇扫描、3:定扫描
        "constant_scan": { // 定扫描模式独有
            "value_type":0，// 0为角度 1为像素点
            "yaw":0.0, // 航偏角，[0,360] 
            "pix":{"x":0, "y":100} // 目标像素，定扫描模式下指定目标像素
        },
        "fan_scanning":{    // 扇扫描模式独有
            "start_angle":0.0, // 起始角度
            "end_angle":0.0 // 终点角度
        },

        "pitch":0.0, // 俯仰角，[-20,35]
        "speed":65535, // 扫描速度，最大值为65535
        "zero_falg":0, // 默认为0，1：电机角度归0操作
        "step":9.0 // 步长，360整除
    }
}

4.机芯控制
request boby:
{
    "conf_name":"chip_ctrl",
    "chip_ctrl":{
        "contrast":50, // 对比度，[0,99]
        "brightness":50, // 亮度，[0,99]
        "polarity":1, // 极性，[0,7]
        "bad_spot_threshold":0, // 坏点阈值，[22,32]
        "bad_spot_oper":0, // 坏点操作，[0,3]
        "hot_spot_track":0 // 热点跟踪，[0,1]
    }
}

5.其他控制
request boby:
{
    "conf_name":"other_ctrl",
    "other_ctrl":{
        "defog_by_heat_enable":0, // 加热去雾控制
        "heat_enable":0, // 加热使能
        "fan_enable":0 // 风扇使能
    }
}

respone boby:
{
    "code":200, // 成功返回200
    "message":"success", // 成功返回success，失败返回失败信息
    "data":"" // 具体数据，无数据为空
}
```
### 获取配置
```json
POST /dev_api/get_config
1.监控区域
request boby:
{
    "conf_name":"areas" // 配置名
}

respone boby:
{
    "code":200, "message":"success",
    "data":{
        "conf_name":"areas",
        "areas":[{
            "area_name":"",
            "enable":1,
            "point_num_max":8,
            "point_num":4,
            "point":[{
                "x":0,
                "y":0
            },{...}]
        },{...}]
    }
}

2.算法开关
request boby:
{
    "conf_name":"algorithm_enable" // 配置名
}

respone boby:
{
    "code":200, "message":"success",
    "data":{
        "conf_name":"algorithm_enable",
        "algorithm_enable": {
            "detection_enable":0, // 目标检测
            "tracking_enable":0, // 跟踪
            "action_analyze_enable":0, // 行为分析
            "tracking_object":[0, 3] // 跟踪目标数及目标id
        }
    }
}

3.云台控制
request boby:
{
    "conf_name":"ptz_ctrl" // 配置名
}

respone boby:
{
    "code":200, "message":"success",
    "data":{
        "conf_name":"ptz_ctrl",
        "ptz_ctrl": { 
            "motor_enable":0， // 电机使能     
            "scan_mode":0, // 扫描模式，1:周扫描、2:扇扫描、3:定扫描
	    "constant_scan": { // 定扫描模式独有
	        "value_type":0，// 0为角度 1为像素点
		"yaw":0.0, // 航偏角，[0,360] 
		"pix":{"x":0, "y":100} // 目标像素，定扫描模式下指定目标像素
	    },
	    "fan_scanning":{    // 扇扫描模式独有
		"start_angle":0.0, // 起始角度
		"end_angle":0.0 // 终点角度
	    },
	    "pitch":0.0, // 俯仰角，[-20,35]
	    "speed":65535, // 扫描速度，最大值为65535
	    "zero_falg":0, // 默认为0
            "step":9.0 // 步长，360整除
	}
    }
}

4.机芯控制
request boby:
{
    "conf_name":"chip_ctrl" // 配置名
}

respone boby:
{
    "code":200, "message":"success",
    "data":{
        "conf_name":"chip_ctrl",
        "chip_ctrl":{
            "contrast":50, // 对比度，[0,99]
            "brightness":50, // 亮度，[0,99]
            "polarity":1, // 极性，[0,7]
            "bad_spot_threshold":0, // 坏点阈值，[22,32]
            "bad_spot_oper":0, // 坏点操作，[0,3]
            "hot_spot_track":0 // 热点跟踪，[0,1]
        }
    }
}

5.其他控制
request boby:
{
    "conf_name":"other_ctrl" // 配置名
}

respone boby:
{
    "code":200, "message":"success",
    "data":{
        "conf_name":"other_ctrl",
        "other_ctrl":{
            "defog_by_heat_enable":0, // 加热去雾控制
            "heat_enable":0, // 加热使能
            "fan_enable":0 // 风扇使能
        }
    }
}
```
### 升级请求
提供升级文件的url，设备端使用wget下载升级包，并保存在指定目录

```json
POST /dev_api/upgrade
request boby:
{
    "upgrade_url":"http://192.168.110.2:8080/xxx" // 升级包下载地址
}

respone boby:
{
    "code":200, "message":"success", 
    "data":""
}
```
### PC服务器信息
dev->pc，使用http协议上传，需要pc创建服务器。但因为pc不同，ip不同，设备不知道pc http服务器的地址，故需要pc下发相关信息。

```json
POST /dev_api/http_svr_info
request boby:
{
    "http_url":"http://192.168.110.2:8080" // pc端http服务器地址端口
}

respone boby:
{
    "code":200, "message":"success", 
    "data":""
}
```
## dev->pc
### 告警上报
```json
POST /pc_api/alarm_info
request boby:
{
    "over_boundary":0, // 越界
    "area_intrude":0, // 区域入侵
    "abnormal_action":0, // 异常行为
    "fire_point_detection":0, // 火点检测
    "temperature_abnormal":0, // 温度异常
    "voltage_abnormal":0, // 电压异常
    "ampere_abnormal":0 // 电流异常
}

respone boby:
{
    "code":200, "message":"success", 
    "data":""
}
```
### 外设信息
```json
POST /pc_api/peripheral_info
request boby:
{
    "yaw":0, // 航偏角
    "pitch":0, // 俯仰角
    "motor_temperature":25, // 电机温度
    "input_voltage":25, // 输入电压
    "working_ampere":22, // 工作电流
    "longitude":0, // 经度（预留）
    "latitude":0 // 纬度（预留）
}

respone boby:
{
    "code":200, "message":"success", 
    "data":""
}
```
